### 二、可变卷积方法详解

#### 1、Deformable Convolutional Networks

+ 基本概念
  卷积神经网络（CNN）由于卷积核固定的几何结构(常见的1x1、3x3和5x5等)，导致其不能够很好地建模存在几何形变（geometric transformations）的物体。提出了可以用于提高CNN建模几何形变能力的模块——deformable convolution和deformable RoI pooling，这两个方法都是通过在目标任务中学习偏移量（offsets）来改变空间中的采样位置。

+ 计算过程
  在标准卷积（standard convolution）中，对于输出特征图 y 上的每一个点 y(p0)，它的计算如下：
  ![](https://ai-studio-static-online.cdn.bcebos.com/b6a65fb4570742c0b7cc64739b94fccfe1ec0563cf88436a9e4582de0c016800)

  

  可变形卷积在标准卷积中的每一个采样点位置上都加了一个可学习的偏置Δpn，其表达式如下：
  ![](https://ai-studio-static-online.cdn.bcebos.com/9f6c4fbd2bbf442594cfc1f192b5b195689204da24084a6fb16992dc9a6fd3dc)

  当Δpn是一个分数时，采用Bilinear interpolation计算 x(p0+pn+Δpn) 的值，即：

  ![](https://ai-studio-static-online.cdn.bcebos.com/18dec319dced426c98070808a0eaa8c4876ece3aa0c342c7be1e58f2660f7e70)

  ![](https://ai-studio-static-online.cdn.bcebos.com/ba31d25496544e448074c8f68c8c240a1b87a9d72187479fb9207021c0c3c22b)

+ 结构
  可变形卷积（deformable convolution）的结构如下图所示：
  ![](https://ai-studio-static-online.cdn.bcebos.com/4ffbc0c6b75045088cd4988c658dee8ae40aeade42d94c92920d89139025fc22)

  

  上面那条支路通过一个卷积层用来学习偏移量（offsets）的大小，其中offset field 的通道数（channel）为2N，N是卷积核的大小，2N是因为output feature map 中的每一个点需要N个Δpn，而Δpn是二维的，需要用两个数表示，如（0.5，-0.5)。

#### 2、Deformable ConvNets v2: More Deformable, Better Results

+ 基本概念
  Deformable ConvNets v2在 V1 的Deformable Convolution 和Deformable RoI Pooling 的基础上，加了一个控制输入强度的标量

+ 计算过程
  Deformable Convolution 表达式如下：

  

  ![](https://ai-studio-static-online.cdn.bcebos.com/6f469f8bdd1744a3884f4e071ae0760043cdf91c13fb498ab1e4724eb8473c00)

  

  与上面 V1 中第二个表达式相比，多了一个可学习的标量Δmk∈[0,1] ，网络结构也与 V1 中的类似，只不过 其中 offset field 的通道数(channel)为3K（V1中是2K,前面 2K 对应可学习偏置 Δpk，后面的 1K 对应强度控制Δmk。

