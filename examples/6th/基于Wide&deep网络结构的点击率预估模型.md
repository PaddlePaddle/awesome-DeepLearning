# 基于Wide&deep网络结构的点击率预估模型


---
##一、简介
描述 
对于广告点击率预估的是一个热点问题,很多从事计算广告的公司都有自己的点击率预估系统,在点击率预估任务中，我们给出谷歌提出的 Wide & Deep 模型。这一模型融合了适用于学习抽象特征的DNN和适用于大规模稀疏特征的逻谛斯克回归两者的优点，可以作为一种相对成熟的模型框架使用，在工业界也有一定的应用。

1.1背景介绍

CTR(Click-Through Rate，点击率预估) 是对用户点击一个特定链接的概率做出预测，是广告投放过程中的一个重要环节。精准的点击率预估对在线广告系统收益最大化具有重要意义。

当有多个广告位时，CTR 预估一般会作为排序的基准，比如在搜索引擎的广告系统里，当用户输入一个带商业价值的搜索词（query）时，系统大体上会执行下列步骤来展示广告：

1.获取与用户搜索词相关的广告集合

2.业务规则和相关性过滤

3.根据拍卖机制和 CTR 排序

4.展出广告

可以看到，CTR 在最终排序中起到了很重要的作用。



##二、模型简介

Wide & Deep Learning Model[3] 可以作为一种相对成熟的模型框架使用， 在 CTR 预估的任务中工业界也有一定的应用，因此本文将演示使用此模型来完成 CTR 预估的任务。

模型结构如下：

![此处输入图片的描述][1]


Wide & Deep的主要特点:
本文提出Wide & Deep模型，旨在使得训练得到的模型能够同时获得记忆（memorization）和泛化（generalization）能力：

记忆（memorization）即从历史数据中发现item或者特征之间的相关性；哪些特征更重要——Wide部分。
泛化（generalization）即相关性的传递，发现在历史数据中很少或者没有出现的新的特征组合；——Deep部分。
在推荐系统中，记忆体现的准确性，而泛化体现的是新颖性。。

##算法流程：
###1.编写模型输入

模型只接受 3 个输入，分别是

dnn_input ，也就是 Deep 部分的输入

lr_input ，也就是 Wide 部分的输入

click ， 点击与否，作为二分类模型学习的标签

###2. Wide 部分

wide部分就是一个广义线性模型，输入主要由两部分，一部分是原始特征，另一部分是交互特征。我们可以通过cross-product transformation的形式来构造K组交互特征：
![此处输入图片的描述][2]
Wide Models 可以简单理解成一个逻辑回归，先将input的特征通过Wx+b得到一个score，再通过sigmoid函数得到probablity。

线性模型的好处，是输入信息能对最终结果产生直接影响，称为记忆能力。

宏观上分析比如要预测一个店铺下个月每一天的销量，那么之前每天的销量均值(可以是按星期几groupby之后的星期几的销量均值)，可见这个均值是对要预估的值有强指代作用(强相关性的)，会对最终结果产生直接影响的，因为以往销量比较高的店铺，下个月的销量大概率应该也不错。
###3. Deep 部分

Deep部分就是一个DNN的模型，每一层计算如下：

![此处输入图片的描述][3]
Deep Models: 相比于wide models 有更强的表达能力，能对特征与特征之间做交叉，就是对不同特征维度的做四则运算(树模型中先按特征a划分成两个子节点，再按特征b划分成四个孙子节点，这也是两个特征之间的交叉)。

深度学习模型的好处，是能挖掘更深层次的信息，有更好的表达能力，就是泛化能力。

Deep 部分对应的特征并不直接作用于结果，而是以一种非线性的形态作用于结果。比如天气状况对销量的影响，是非线性的，所以需要非线性模型来表达特征。
###4.两者融合

Wide & Deep模型采用的是联合训练的形式，而非集成。二者的区别就是联合训练公用一个损失函数，然后同时更新各个部分的参数，而集成方法是独立训练N个模型，然后进行融合。因此，模型的输出为：
![此处输入图片的描述][4]
###5.训练任务的定义
###6.运行训练和测试
训练中原始的稀疏特征，在两个组件中都会用到，比如query="fried chicken" item="chicken fried rice":

在训练的时候，根据最终的loss计算出gradient，反向传播到Wide和Deep两部分中，分别训练自己的参数。也就是说，两个模块是一起训练的（也就是论文中的联合训练），注意这不是模型融合。

Wide部分中的组合特征可以记住那些稀疏的，特定的rules

Deep部分通过Embedding来泛化推荐一些相似的items

Wide模块通过组合特征可以很效率的学习一些特定的组合，但是这也导致了他并不能学习到训练集中没有出现的组合特征。所幸，Deep模块弥补了这个缺点。
另外，因为是一起训练的，wide和deep的size都减小了。wide组件只需要填补deep组件的不足就行了，所以需要比较少的cross-product feature transformations，而不是full-size wide Model。
###7. 用训好的模型做预测

训好的模型可以用来预测新的数据

##使用范围：
WideAndDeep模型适用于非常稀疏的大规模分类或回归问题。比如推荐系统、search、ranking问题。

输入稀疏通常由离散特征有非常非常多个可能的取值造成的，one-hot之后维度非常大。

。

  [1]: https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vZnVoYWlsaW4vT2JqZWN0LVN0b3JhZ2UtU2VydmljZS9yYXcvbWFzdGVyL3dpZGVfYW5kX2RlZXAud2VicA?x-oss-process=image/format,png
  [2]: https://img-blog.csdnimg.cn/20200113141913168.png
  [3]: https://img-blog.csdnimg.cn/20200113141939637.png
  [4]: https://img-blog.csdnimg.cn/2020011314244866.png