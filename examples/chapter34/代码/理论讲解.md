[toc]
# 眼疾识别数据集iChallenge-PM
iChallenge-PM是百度大脑和中山大学中山眼科中心联合举办的iChallenge比赛中，提供的关于病理性近视（Pathologic Myopia，PM）的医疗类数据集，包含1200个受试者的眼底视网膜图片，训练、验证和测试数据集各400张。 
- training.zip：包含训练中的图片和标签
- validation.zip：包含验证集的图片
- valid_gt.zip：包含验证集的标签


# 数据集准备
iChallenge-PM中既有病理性近视患者的眼底图片，也有非病理性近视患者的图片，命名规则如下：

病理性近视（PM）：文件名以P开头

非病理性近视（non-PM）：

高度近视（high myopia）：文件名以H开头

正常眼睛（normal）：文件名以N开头

我们将病理性患者的图片作为正样本，标签为1；非病理性患者的图片作为负样本，标签为0。从数据集中选取两张图片，通过LeNet提取特征，构建分类器，对正负样本进行分类，并将图片显示出来。

# ResNet50
Resnet是残差网络(Residual Network)的缩写,该系列网络广泛用于目标分类等领域以及作为计算机视觉任务主干经典神经网络的一部分，典型的网络有resnet50, resnet101等。Resnet网络的证明网络能够向更深（包含更多隐藏层）的方向发展。

## 网络结构

下面是网络模型的整体模型图。其中的CONV表示卷积层，Batch Norm表示Batch 归一化层，ID BLOCK表示Identity块，由多个层构成。Conv BLOCK表示卷积块，由多个层构成。为了使得model个结构更加清晰，才提取出了conv block 和id block两个‘块’，分别把它们封装成函数。

![](images/整体结构.png)

### Identity Block
ResNet50有2个基本的block，一个是Identity Block，输入和输出的dimension是一样的，所以可以串联多个；另外一个基本block是Conv Block，输入和输出的dimension是不一样的，所以不能连续串联，它的作用本来就是为了改变特征向量的dimension。

![](images/ID%20block.png)

### Conv Block

因为CNN最后都是要把输入图像一点点的转换成很小但是depth很深的feature map，一般的套路是用统一的比较小的kernel（比如VGG都是用3*3），但是随着网络深度的增加，output的channel也增大（学到的东西越来越复杂），所以有必要在进入Identity Block之前，用Conv Block转换一下维度，这样后面就可以连续接Identity Block.

![](images/conv%20block.png)

# 代码实践

在代码实践中，这里首先使用了LeNet对数据进行初步的测试，得到结果一般，准确率约为80多，然后这里又使用了InceptionV4，但是效果差，准确率略高于50%，推测原因是网络结构复杂，而数据量少，无法得到较好的结果，因此最终，我们采用了ResNet50作为最终选定的网络结构，经过多次训练，结果稳定在90%以上，并达到。

在实践中，首先做的是将压缩的数据提取出来，然后进行读取，将图片缩放到224*224的大小，便于处理，然后调整到-1~1之间，然后定义网络结构，训练与测试函数，这里选用了Adam作为优化器，并使用二元交叉熵损失，并记录训练过程中，验证集的损失和准确率，并作图，得到结果如下图所示：

![结果图](images\结果图.png)

由图中可以看出，网络在训练初期，准确率就可以达到很高，并在训练的过程中稳定很高，损失整体也在变小，随着训练迭代次数的增加，准确率到后期慢慢降低，损失也逐渐身高，说明发生了过拟合，模型在训练集损失更小，而在验证集效果却变差，可以采用一些方法，如增加正则化，对图像进行一些预处理，如旋转、亮度变化等操作，从而使得网络适用性更强。